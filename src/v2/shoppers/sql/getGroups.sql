-- gets all the cohorts for the shopper ID
-- associated with the user

SET @shopperId = UUID_TO_BIN(:shopperId);

SELECT
  BIN_TO_UUID(c.ID) AS ID,
  c.NAME,
  BIN_TO_UUID(c.OWNER_ID) AS OWNER_ID,
  own.NICKNAME AS OWNER_NICKNAME,
  own.EMAIL AS OWNER_EMAIL
FROM PANTRY_PLUS.SHOPPER sh
JOIN PANTRY_PLUS.COHORT_SHOPPER_RELATION csr ON csr.SHOPPER_ID = sh.ID
JOIN PANTRY_PLUS.COHORT c ON c.ID = csr.COHORT_ID
JOIN PANTRY_PLUS.SHOPPER own ON c.OWNER_ID = own.ID
WHERE sh.ID = @shopperId
UNION
SELECT
  BIN_TO_UUID(c.ID) AS ID,
  c.NAME,
  BIN_TO_UUID(c.OWNER_ID) AS OWNER_ID,
  own.NICKNAME AS OWNER_NICKNAME,
  own.EMAIL AS OWNER_EMAIL
FROM PANTRY_PLUS.COHORT c
JOIN PANTRY_PLUS.SHOPPER own ON c.OWNER_ID = own.ID
WHERE c.OWNER_ID = @shopperId
;